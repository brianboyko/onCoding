<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-9f705640800a2eac4cf9.js" as="script"/><link rel="preload" href="/component---src-templates-blog-template-js-3c042b543a488014fe7b.js" as="script"/><link rel="preload" href="/path---blog-working-with-dynamic-type-c3c4a86400e50f52b7c0.js" as="script"/><link rel="preload" href="/app-c2e40a0af1b627ce1775.js" as="script"/><link rel="preload" href="/commons-8dcba3f9452ce054e0e3.js" as="script"/><title data-react-helmet="true">Brian Boyko (On Coding)</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Fjalla+One|Inconsolata|Sorts+Mill+Goudy" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><style id="gatsby-inlined-css">@import url(https://fonts.googleapis.com/css?family=Fjalla+One|Inconsolata|Roboto|Roboto+Slab);.header__container{background-color:#6495ed;margin-bottom:1.45rem}.header__title{margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem;font-family:Roboto Slab}.header__title__text{color:#fff;text-decoration:none}code[class*=language-],pre[class*=language-]{-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;white-space:pre-wrap;word-wrap:normal;font-family:Menlo,Monaco,Courier New,monospace;font-size:14px;color:#76d9e6;text-shadow:none}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2a2a2a}pre[class*=language-]{padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative}pre[class*=language-] code{white-space:pre;display:block}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000}.token.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6f705e}.token.boolean,.token.number,.token.operator{color:#a77afe}.language-css .token.string,.style .token.string,.token.attr-name,.token.entity,.token.string,.token.url{color:#e6d06c}.token.inserted,.token.selector{color:#a6e22d}.token.atrule,.token.attr-value,.token.deleted,.token.important,.token.keyword{color:#ef3b7d}.token.regex,.token.statement{color:#76d9e6}.token.placeholder,.token.variable{color:#fff}.token.bold,.token.important,.token.statement{font-weight:700}.token.punctuation{color:#bebec5}.token.entity{cursor:help}.token.italic{font-style:italic}code.language-markup{color:#f9f9f9}code.language-markup .token.tag{color:#ef3b7d}code.language-markup .token.attr-name{color:#a6e22d}code.language-markup .token.attr-value{color:#e6d06c}code.language-markup .token.script,code.language-markup .token.script .token.keyword,code.language-markup .token.style{color:#76d9e6}pre[class*=language-][data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:0;margin-top:1em;background:hsla(0,0%,100%,.08);pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:.2em .5em;background-color:hsla(0,0%,100%,.4);color:#000;font:700 65%/1 sans-serif;height:1em;line-height:1em;text-align:center;border-radius:999px;text-shadow:none;box-shadow:0 1px 1px hsla(0,0%,100%,.7)}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}.chip{background-color:#4a6fa5;padding:5px 10px;margin:10px 5px;color:#fff;width:auto;border-radius:10px;font-family:Inconsolata,monospace}.chip__container{margin-left:-5px}.blog-post{font-family:Roboto Slab}.blog-post__title{font-family:Fjalla One}.blog-post__date{font-family:Roboto}.postlink{margin-bottom:50px;padding-left:10px;border-left:1px solid #6495ed}.postlink__title{font-family:Roboto Slab;font-size:24px;margin:20px 0 10px}.postlink__title__link{text-decoration:none}.postlink__date{font-family:Roboto;font-size:12px;font-style:italic;margin-bottom:10px}.postlink__tags{font-family:Inconsolata;color:#888;margin-bottom:10px}.postlink__tags__tag{margin-right:20px}.blog-post-list{font-family:Roboto}.bio{float:right;width:300px;margin:0 0 20px 40px;padding:20px;background-color:#6495ed;font-family:Roboto;color:#fff;font-size:16px}.bio a{color:#ff0}.bio img{width:100px;float:left;padding:3px;border:1px solid #888;margin:0 20px 20px 0}</style></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="-473759943"><!-- react-empty: 2 --><div class="header__container" data-reactid="3"><div class="header__title" data-reactid="4"><h1 style="margin:0;" data-reactid="5"><a class="header__title__text" href="/" data-reactid="6">Brian Boyko (On Coding)</a></h1></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0;" data-reactid="7"><div class="blog-post__container" data-reactid="8"><div class="blog-post" data-reactid="9"><div style="background-image:url(/static/defaultImage-bf9d9895bd7ec25009144b0f166399c4.jpg);background-size:cover;height:auto;margin-bottom:40px;" data-reactid="10"><div style="color:white;padding:150px 20px 20px 20px;background:rgba(0, 0, 0, 0.3);" data-reactid="11"><h1 class="blog-post__title" data-reactid="12">Working with dynamic type</h1><h2 class="blog-post__date" data-reactid="13">11 March, 2016</h2><span class="chip__container" data-reactid="14"><span class="chip" data-reactid="15"><span data-reactid="16">javascript</span></span><span class="chip" data-reactid="17"><span data-reactid="18">dynamic type</span></span></span></div></div><div class="blog-post-content" data-reactid="19"><p>There's a saying: Systems that prevent you from doing stupid things also prevent you from doing clever things.  </p>
<p>At work, there's a bug that we can't reproduce, and didn't have time to track down and fix before a major pre-alpha display of our software.  Worse still, this bug would cause the problem to hang the entire application. </p>
<p>And we had less than 24 hours to go before we had to demo the software to our client. </p>
<p>Now, we'll eventually track it down (that's what the Redux refactor is for, partially), but, for right now, if we couldn't predict or reproduce this error reliably, we needed a way to detect when the error occurred and find a way to fail gracefully (which would be acceptable, if not great, for our client's users) But how? The error was uncommon, and seemed to happen at different times and different places for different reasons, usually only inside the game itself. This makes debugging particularly hard, as the game only runs on Windows, but my development tools are on Linux... explaining why I have two computers and not a VM would take a while, so let's just say, <em>"it wasn't my choice"</em>, and <em>"that's the way it is."</em></p>
<p>With less than 24 hours before a big deployment to show our client, we needed at least a way to fail gracefully.  </p>
<p>The solution I came up with is either "very clever" or "very hacky", or both, depending on how you look at it.  Essentially, the only commonality the bug had in common was that it would display our loading bar interminably.  But for that to happen, our main component's state (we use React) had to have loading == true.  </p>
<p>The immediate idea I had was to set a timeout for 30000 milliseconds, that starts when loading = true, and ends when loading = false at any point. But for some reason, the clearTimeout wasn't working.  Perhaps it was because of something in the code that I hadn't accounted for - the legacy code is pretty spaghettified at this point.  I needed an alternative way to do this.  </p>
<p>I thought about creating another variable in the state called "lastLoaded," with a timestamp, which showed when the loading screen was last launched.  But there were two problems.  First, this wouldn't let you know if there was a time between when the timestamp was created and "now" where loading was set to "false".  Alternatively, you could change the timestamp every time that loading changed state from true to false, but then you have to check two variables regularly in order to determine if the bug had occured.  And adding another variable to the already overloaded component state wasn't going to help our spaghetti problem much. </p>
<p>So, to solve this (and remember, this is a kludge workaround, produced under deadline), I took advantage of one of Javascript's most maligned "features."  Dynamic type. </p>
<p>Essentially, whenever we want to show the loading bar, I changed this.setState({loading:true}) to this.setState({loading:Date.now()}).  But I kept every instance of this.setState({loading:false}) intact.  Then on checking the conditionals, instead of saying if (this.state.loading == true); I changed it to if(!!this.state.loading == true);  </p>
<p>Numbers are truthy values in Javascript, meaning that if you force them into booleans by prefixing the variable name with !, you end up with "false."  !!, or "not not", evaluates as "true". If I would have been using TypeScript or a static type language, I, at least, would have had to change every setState of loading:false to loading: 0... if I was lucky and the language I was using evaluates the number 0 as falsy, and every other number to be truthy.  And this would have been a cause for major concern because the key way to set the fail-gracefully condition was to check if it had been more than 30000 seconds since we showed the loading screen.  It has <em>absolutely</em> been at <em>least</em> 30 seconds since January 1, 1970.  </p>
<p>Now, TypeScript (or Gilbert.js's <a href="http://js-zero.com/">Javascript Zero</a>) is a great solution for those who need static type checking. And it is true that static type checking can help prevent those nasty: "I expected value to equal 8675309, but value was equal to '8675309'" bugs.  But if dynamic type is a part of the language, if there's a usecase for it (and you document it well), why not use it?</p>
<p>Hopefully, the refactor I'm working on (which is mostly done) will eventually cause this to be moot, as when the bug occurs, instead of hanging the problem, we can simply rewind and replay state if it's a problem with the backend, or have detailed logs about when this occurs on the front-end. </p></div></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-c2e40a0af1b627ce1775.js","122212659448958":"component---src-templates-blog-template-js-3c042b543a488014fe7b.js","162898551421021":"component---src-pages-404-js-4503918ea3a16cfcdb75.js","35783957827783":"component---src-pages-index-js-7527d36b6fa11011beaf.js","218538773642512":"component---src-pages-page-2-js-1d4f0f19c1c44398ab65.js","60335399758886":"path----a80995809b8403e73bc5.js","242864849891142":"path---blog-the-ziggurat-architecture-05f2dda6863c97ff6e9c.js","271492005434849":"path---blog-getters-and-setters-antipattern-9b180c36487a395bc3c0.js","168224806347839":"path---blog-typescript-i-get-it-6da6f657d07e78df2396.js","184270320657383":"path---blog-private-and-protected-90a2c08d9e0cbd6d5f02.js","163844919532138":"path---blog-react-before-vue-bdd2a9ee284f0a522e6e.js","236448225686559":"path---blog-typescript-i-dont-get-it-6166ac3f8b8967676fb4.js","262036473486485":"path---blog-css-in-js-seperate-concerns-552046c42615378ea2d4.js","115491676190894":"path---blog-stupid-redux-tricks-759a2be7238596a56e13.js","258654615034557":"path---blog-react-is-just-a-view-871760e724399a2af83a.js","49926254253336":"path---blog-currying-thinking-with-portals-659f5c6458fb3a1c45fb.js","41763247558397":"path---blog-d-3-in-react-887139337476a98b019a.js","220485664280490":"path---blog-c-live-dangerously-85a5b65ac2d54fc15443.js","92893447782357":"path---blog-coding-on-paper-ccf1054d34344e094de3.js","31428463216379":"path---blog-the-hip-0b55fa731bcf63c77d6f.js","21394539151705":"path---blog-interestinglinks-1-8f79b4eafae6231a9d46.js","227515882628393":"path---blog-video-hack-reactor-1-8b34ae49d2625fcc267e.js","280364320100666":"path---blog-cool-tools-b206b8dae8afda33936d.js","261444995959908":"path---blog-random-redux-thoughts-fa8258b3aa70ace7e293.js","16873448567208":"path---blog-redux-mobx-78a64b0bc290d437b87e.js","69855552298772":"path---blog-the-other-side-1860977921b26dce669b.js","144584405630298":"path---blog-git-and-subversion-9f332217437bc1eba902.js","252476015291409":"path---blog-working-with-dynamic-type-c3c4a86400e50f52b7c0.js","121292126702233":"path---blog-why-redux-0dec19182a5496f94220.js","157254306246868":"path---blog-doing-it-right-vs-doing-it-fast-04b8961e7a3bcbdc7f54.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-88413982bdeb586b3489.js","135728916539164":"path---page-2-a0e39f21c11f6a62c5ab.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-9f705640800a2eac4cf9.js"}/*]]>*/</script><script>/*<![CDATA[*/["/commons-8dcba3f9452ce054e0e3.js","/app-c2e40a0af1b627ce1775.js","/path---blog-working-with-dynamic-type-c3c4a86400e50f52b7c0.js","/component---src-templates-blog-template-js-3c042b543a488014fe7b.js","/component---src-layouts-index-js-9f705640800a2eac4cf9.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>