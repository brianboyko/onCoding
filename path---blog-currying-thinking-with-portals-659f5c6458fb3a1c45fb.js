webpackJsonp([49926254253336],{411:function(n,a){n.exports={data:{markdownRemark:{html:'<p>Being able to be a good programmer is a lot like playing a puzzle game.  Like Portal 2. </p>\n<p>In Portal 2, you\'re given a tool called a portal gun that greatly changes the laws of physics so that you can place an instant passage between two places in space. In so doing, you\'re able to create solutions to puzzles that would otherwise be quite frankly, impossible.  But until you learn to think with what the new tool gives you -- to "think with portals," in other words, you may end up doing things the long way around.  </p>\n<p>One of those conceptual thinking tricks in Javascript is called "currying".  And once you\'re familiar with it, it makes your code just that much more powerful.  </p>\n<p>I\'m working on a few side projects, including the re-doing of my HackReactor thesis project using what I\'ve learned over my years in the field. (Programming is the perfect endeavor for anyone who wants to fight a younger version of themselves.) </p>\n<p>One simple thing that you\'d think couldn\'t be improved -- but which has improved -- is how I create database models for my database.  I use Knex, which I won\'t get into here -- this really isn\'t about databases. </p>\n<p>What it is about, however, is functional programming.  </p>\n<p>Back when I was learning Javascript, I thought this might be a good way to organize my database models: I\'d have basic "create, read, update, del" objects, and give them various values. </p>\n<p>So, imagine a "USERS" table in an SQL database. It\'s set up like this: </p>\n<div class="gatsby-highlight" data-language="plaintext">\n      <pre class="language-plaintext"><code class="language-plaintext">  uid: the auto-incrementing user id\n  login: the username\n  password the (hashed) password\n  email: the user&#39;s email address\n  first_name: the user&#39;s first name\n  last_name: the user&#39;s last name\n  created_at: timestamp of creation \n  updated_at: timestamp of when this was last updated</code></pre>\n      </div>\n<p>So, I\'d want to create ways to look up users by a variety of methods - and remembering to assume that the person who maintains my code is an convicted axe murderer who has my home address, I want to make my code easy to understand. </p>\n<p>So, to access some value in my model, I think I want to use simple words.  Something like: "Users.read.by_id(|some number|)".  It\'s easy to tell what that does.  </p>\n<p>So, I\'d have a read object, with a "read.by_id" method, "read.by_login" method, and so on.  And I\'d write them out individually, like this: </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript">  Users<span class="token punctuation">.</span>read <span class="token operator">=</span> <span class="token punctuation">{</span>\n    by_id<span class="token punctuation">:</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    by_login<span class="token punctuation">:</span> <span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    by_email<span class="token punctuation">:</span> <span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    by_name<span class="token punctuation">:</span> <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span> <span class="token operator">=></span> \n      <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> first_name<span class="token punctuation">,</span> last_name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> \n  <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>And for what it\'s worth, that\'s not a bad way to do it.  But it seems to me that there\'s an awful lot of repetition. How many times do we type "knex(\'USERS\')" and ".where()" and ".select()" Can\'t there be a better way? Plus, what happens if I, for some weird reason, need to access a property that I\'m not really using all that often.  </p>\n<p>What if you\'re writing a geneology database, and you get a request from the Beiber family to return all of the people with the last name of Beiber, but NOT if the first name is Justin? It\'d be nice to be flexible.  </p>\n<p>So instead of writing out all the cases I can think of, I can use higher order functions and functions that return functions. </p>\n<p>Like so: </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ./src/db/models/Users.js</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>knex<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n\n   <span class="token comment">// line one.</span>\n   <span class="token keyword">let</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token punctuation">(</span>by<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>lookup<span class="token punctuation">)</span> <span class="token operator">=></span> \n     <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>by<span class="token punctuation">]</span> <span class="token punctuation">:</span> lookup <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// line two. </span>\n   <span class="token punctuation">[</span><span class="token string">\'uid\'</span><span class="token punctuation">,</span> <span class="token string">\'login\'</span><span class="token punctuation">,</span> <span class="token string">\'email\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n     read<span class="token punctuation">[</span><span class="token string">"by_"</span> <span class="token operator">+</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">//line three</span>\n   read<span class="token punctuation">.</span><span class="token function-variable function">by_name</span> <span class="token operator">=</span> <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> last_name<span class="token punctuation">)</span> <span class="token operator">=></span>\n     <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> first_name<span class="token punctuation">,</span> last_name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    read<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>So, let\'s look through this code here.  </p>\n<p>The first thing that might trip you up is the double arrow syntax.  It\'s really not that difficult - remember that arrow functions are just functions with a whole lot of boilerplate removed. (They also .bind(this) automatically, but let\'s not worry about that right now.) </p>\n<p>so, this would be an equivalent statement in ES4/5 for line one:</p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>lookup<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> keyVal <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    keyVal<span class="token punctuation">[</span>by<span class="token punctuation">]</span> <span class="token operator">=</span> lookup<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>keyVal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> \n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Essentially, what "read" takes is a parameter, "by", and it returns a function that takes a parameter "lookup".  </p>\n<p>That function, in turn, returns the information we\'re looking for. </p>\n<p>Now, you may be asking, <em>why, for the love of all that\'s good and holy, didn\'t I do this?</em> </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token punctuation">(</span>by<span class="token punctuation">,</span> lookup<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">\'USERS\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>by<span class="token punctuation">]</span> <span class="token punctuation">:</span> lookup <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>Well, that\'s a good point.  It is a bit more straightforward.  But in order to use that, we\'d need to know <em>both</em> the "by" variable, and the "lookup" variable at the time we create it.  </p>\n<p>In some cases, <em>especially with asynchronous operations</em>, we don\'t want to wait until we have all the variables before we start working on the problem.  This is especially true with a particularly hairy algorithm, one that might make multiple async calls to databases, third-party APIs, etc.  </p>\n<p>But in this case, the main thing is just to have more readable code in the controllers I\'d eventually write, that follows the "Users.|do something|.by_|some key in the table|" pattern.  </p>\n<p>What I\'ve done with the "function that returns a function" pattern is currying, and it essentially lets you create multiple functions that do mostly the same thing but in different ways.  </p>\n<p>So, if, for example, if I wanted to look up a record something by the login name, this is a perfectly valid way to do it: </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ./src/main.js</span>\n<span class="token keyword">import</span> usermodel <span class="token keyword">from</span> <span class="token string">\'./src/db/models/Users\'</span><span class="token punctuation">;</span> \n<span class="token keyword">import</span> knex <span class="token keyword">from</span> <span class="token string">\'./src/db/config\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> Users <span class="token operator">=</span> <span class="token function">usermodel</span><span class="token punctuation">(</span>knex<span class="token punctuation">)</span><span class="token punctuation">;</span> \n\nUsers<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">\'login\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">\'bieberluver69\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre>\n      </div>\n<p>The function "Users.read(\'login\')" is evaluated first, and it returns a function. <em>That</em> function is then called with the parameter(\'bieberluver69\').  </p>\n<p>What\'s interesting is that we can split this up.  This does the same thing as the above: </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token comment">// ./src/main.js</span>\n<span class="token keyword">import</span> usermodel <span class="token keyword">from</span> <span class="token string">\'./src/db/models/Users\'</span><span class="token punctuation">;</span> \n<span class="token keyword">import</span> knex <span class="token keyword">from</span> <span class="token string">\'./src/db/config\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> Users <span class="token operator">=</span> <span class="token function">usermodel</span><span class="token punctuation">(</span>knex<span class="token punctuation">)</span><span class="token punctuation">;</span> \n\n<span class="token keyword">const</span> readByLogin <span class="token operator">=</span> Users<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">\'login\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">readByLogin</span><span class="token punctuation">(</span><span class="token string">\'bieberluver69\'</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>(If it helps you to think of it this way, Users.read() is a "mommy function" that takes a "parameter from daddy", and gives birth to a "baby function". Just don\'t use that terminology in technical interviews.) </p>\n<p>By now, you\'ve probably also figured out that the Users model itself is a lot like a curried function! Only it doesn\'t return a function - it returns an object that has a function as it\'s property.  This is "dependency injection" and it\'s also important for a bunch of stuff. (but more on that some other time.)  </p>\n<p>Okay, onto line two.  </p>\n<div class="gatsby-highlight" data-language="javascript">\n      <pre class="language-javascript"><code class="language-javascript">  <span class="token comment">// line two. </span>\n  <span class="token punctuation">[</span><span class="token string">\'uid\'</span><span class="token punctuation">,</span> <span class="token string">\'login\'</span><span class="token punctuation">,</span> <span class="token string">\'email\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    read<span class="token punctuation">[</span><span class="token string">"by_"</span> <span class="token operator">+</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>You can probably guess what\'s going on here.  We\'re taking the strings "uid", "login", "email" - and we\'re passing them in as parameters to curry into the read function. </p>\n<p>Then all we have to do is put those curried functions somewhere, in one object.  Hey, wait, we already have an object!  "read" is a function, but in Javascript, <em>all functions are objects.</em>  Which means <em>you can add methods to a function.</em> </p>\n<p>Now, you can call read() by itself, or access the read.by_uid(), read.by_login(), and read.by_email() parameters. </p>\n<p>Now, there are going to be times that you have to come up with special cases.  We want read.by_name() to take two parameters and match against them both, so we really can\'t generate this automatically using the read() function.  In that case, we define it individually, with line three. </p>\n<p>But, even so, now this pattern can be re-used, and getting the rest of the models completed using this pattern can be so much simpler.  When we go to the next table in the database, we\'ll be able to reuse this code... in fact, <em>theoretically</em>, we can curry this further, simply by turning the literal string \'USERS\' into a variable.</p>\n<p>But that\'s an exercise for another day.  </p>',frontmatter:{date:"05 February, 2017",path:"/blog/currying-thinking-with-portals",title:"Currying: Now you're thinking with portals",tags:["beginning coding"],featuredImage:{publicURL:"/static/defaultImage-bf9d9895bd7ec25009144b0f166399c4.jpg",childImageSharp:{sizes:{srcSet:"/static/defaultImage-bf9d9895bd7ec25009144b0f166399c4-23bad.jpg 310w,\n/static/defaultImage-bf9d9895bd7ec25009144b0f166399c4-b3870.jpg 620w,\n/static/defaultImage-bf9d9895bd7ec25009144b0f166399c4-f0cf2.jpg 950w"}}}}}},pathContext:{}}}});
//# sourceMappingURL=path---blog-currying-thinking-with-portals-659f5c6458fb3a1c45fb.js.map